@using Entity
@model List<ChatMessage>
@{
    ViewData["Title"] = "聊天室";
}

<div class="layui-container">
    <div class="layui-card">
        <div class="layui-card-header">
            <button class="layui-btn" onclick="history.back()">返回</button>
        </div>
        <div class="layui-card-body">
            <div id="chatMessages">
                @foreach (var msg in Model)
                {
                    <div class="@(msg.SenderId == ViewBag.UserId ? "right" : "left")">
                        <div>@msg.Content</div>
                        <div>@msg.SentAt.ToString("HH:mm")</div>
                    </div>
                }
            </div>
            <input type="text" id="messageInput" />
            <button onclick="sendMessage()">发送</button>
        </div>
    </div>
</div>

<script>
    function sendMessage() {
        const input = document.getElementById('messageInput');
        fetch('/Chat/SendMessage?roomId=@ViewBag.RoomId', {
            method: 'POST',
            body: JSON.stringify({ message: input.value }),
            headers: { 'Content-Type': 'application/json' }
        }).then(() => location.reload());
    }
</script>